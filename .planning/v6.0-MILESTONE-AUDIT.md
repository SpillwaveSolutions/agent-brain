---
milestone: v6.0
audited: 2026-02-12
status: gaps_found
scores:
  requirements: 34/34
  phases: 4/4
  integration: 1/2
  flows: 1/2
gaps:
  requirements: []
  integration:
    - "Storage backend selection does not drive runtime QueryService/IndexingService wiring (legacy vector_store + bm25_manager path still used)."
  flows:
    - "Configure backend -> setup postgres -> run server -> query breaks because services still use Chroma backend."
tech_debt:
  - phase: 06-postgresql-backend
    items:
      - "Run postgres-backed E2E flow: start Postgres, switch storage.backend, index and query real data."
      - "Validate cross-backend consistency with live data (hybrid top-5 similarity)."
      - "Exercise connection pool under load with live Postgres and monitor /health/postgres metrics."
  - phase: 07-testing-ci
    items:
      - "Re-run task before-push when PyPI/network connectivity is available."
      - "Optionally run postgres-marked contract/load tests with a real database to validate happy paths."
---

# Milestone Audit — v6.0 PostgreSQL Backend

## Scope

- **Milestone:** v6.0 PostgreSQL Backend
- **Phases in scope:** 05-storage-abstraction, 06-postgresql-backend, 07-testing-ci, 08-plugin-documentation
- **Definition of done:** Backend selection, postgres backend implementation, CI coverage, plugin/docs updates (per ROADMAP.md)

## Phase Verification Summary

| Phase | Status | Notes |
| --- | --- | --- |
| 05-storage-abstraction | passed | Protocol + factory + services validated |
| 06-postgresql-backend | passed | Backend implementation verified; human validation deferred |
| 07-testing-ci | passed | Contract/load tests + CI wiring; PyPI outage noted |
| 08-plugin-documentation | passed | Plugin/docs updates verified and approved |

## Integration Check

**Status:** gaps_found

### Missing Connections
- **Storage backend wiring:** `agent-brain-server/agent_brain_server/api/main.py` constructs `QueryService` and `IndexingService` with `vector_store` + `bm25_manager`, bypassing `app.state.storage_backend` when postgres is selected.

### Orphaned Exports
- `/health/postgres` exists but is not referenced by runtime callers (unit tests only).

## End-to-End Flows

**Complete:**
- CI runs postgres tests via service container (pgvector image + DATABASE_URL + postgres extras).

**Broken:**
- Configure backend -> setup postgres -> run server -> query (breaks at service wiring; postgres backend not used for queries/indexing).

## Requirements Coverage

All v6.0 requirements are implemented and verified at the component level (34/34). The integration gap above blocks end-to-end use of the postgres backend, so the milestone status is **gaps_found** despite full requirement coverage.

## Tech Debt (Non-blocking)

### Phase 06 — PostgreSQL Backend
- Run a full postgres-backed E2E flow (index + query) to validate runtime behavior.
- Validate cross-backend hybrid similarity with live data.
- Exercise pool under load with real Postgres and review `/health/postgres` metrics.

### Phase 07 — Testing & CI
- Re-run `task before-push` once network/PyPI outage clears.
- Optionally run postgres-marked tests against a real database.

## Recommendation

Close the integration gap by wiring `QueryService` and `IndexingService` to `app.state.storage_backend` in `agent-brain-server/agent_brain_server/api/main.py` so postgres selection is honored at runtime. Then re-run milestone audit.
